{% extends "base.html" %}

{% block title %}AgriConnect - Weather Forecast{% endblock %}

{% block bodyclass %}weather-page{% endblock %}

{% block content %}
<div class="container">
    <a href="/dashboard" class="back-button">&larr; Back to Dashboard</a>
    <h1>Localized Weather Forecast</h1>
    <div class="weather-banner">
        <img src="https://images.unsplash.com/photo-1561583534-09e822ba83ba" alt="Weather Field" class="weather-banner-image">
    </div>
    <div class="weather-card">
        <div class="weather-icon">
            <img src="https://images.unsplash.com/photo-1592210454359-9043f067919b" alt="Weather Condition">
        </div>
        <div class="weather-info">
            <p><strong>Location:</strong> {{ weather.location.name }}, {{ weather.location.region }}, {{ weather.location.country }}</p>
            <p><strong>Temperature:</strong> {{ weather.current.temp_c }}°C</p>
            <p><strong>Condition:</strong> {{ weather.current.condition.text }}</p>
        </div>
        <div class="weather-alerts">
            <h3>⚠️ Risk Alerts</h3>
            <p class="alert-message">No immediate alerts. The conditions are favorable for farming.</p>
        </div>
    </div>

    <div class="weather-actions" style="margin-top: 16px;">
        <button id="use-gps" class="btn">Use My Location</button>
    </div>
</div>
<script>
document.getElementById('use-gps').addEventListener('click', () => {
    if (!navigator.geolocation) {
        alert('Geolocation is not supported by your browser.');
        return;
    }
    navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude.toFixed(4);
        const lon = pos.coords.longitude.toFixed(4);
        const url = new URL(window.location.href);
        url.searchParams.set('location', `${lat},${lon}`);
        window.location.href = url.toString();
    }, (err) => {
        alert('Unable to fetch location: ' + err.message);
    }, { enableHighAccuracy: true, timeout: 10000 });
});
</script>
{% endblock %}